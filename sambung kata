-- =================================================================
-- Nama Script : KAMUS SAKU VERTIKAL (DARK NEON - BUG FIX)
-- Author      : Hammmm
-- Description : Tool pencarian kata KBBI in-game ringan
-- =================================================================

-- // 1. SERVICES & LOCAL PLAYER // --
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- Menentukan lokasi GUI (Exploit menggunakan CoreGui, Studio menggunakan PlayerGui)
local parentGui = CoreGui or LocalPlayer:WaitForChild("PlayerGui")

-- Membersihkan GUI lama jika script dieksekusi ulang (Anti-Duplikasi)
if parentGui:FindFirstChild("KamusNeonGUI") then
	parentGui.KamusNeonGUI:Destroy()
end

-- // 2. CONFIGURATION & VARIABLES // --
local URL_KAMUS = "https://raw.githubusercontent.com/geovedi/indonesian-wordlist/master/01-kbbi3-2001-sort-alpha.lst"
local KamusIndonesia = {}
local isMinimized = false 

-- Tema Warna Dark Neon
local NEON_COLOR = Color3.fromRGB(0, 255, 240) 
local DARK_BG    = Color3.fromRGB(12, 12, 15) 
local INPUT_BG   = Color3.fromRGB(25, 25, 35) 

-- // 3. MEMBANGUN MAIN GUI // --
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KamusNeonGUI"
ScreenGui.Parent = parentGui

local Frame = Instance.new("Frame")
Frame.Name = "MainFrame"
Frame.Size = UDim2.new(0, 180, 0, 235) 
Frame.Position = UDim2.new(1, -220, 0.5, -117) 
Frame.BackgroundColor3 = DARK_BG 
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true -- Membuat UI bisa digeser
Frame.ClipsDescendants = true 
Frame.ZIndex = 1
Frame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = Frame

local NeonGlow = Instance.new("UIStroke")
NeonGlow.Thickness = 3 
NeonGlow.Color = NEON_COLOR 
NeonGlow.Transparency = 0.1 
NeonGlow.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
NeonGlow.Parent = Frame

-- // 4. MEMBANGUN ELEMEN HEADER & TOMBOL // --
local Judul = Instance.new("TextLabel")
Judul.Name = "TitleLabel"
Judul.Size = UDim2.new(1, -80, 0, 35) 
Judul.Position = UDim2.new(0, 10, 0, 0)
Judul.BackgroundTransparency = 1
Judul.Text = "Duckiezt System..."
Judul.TextColor3 = NEON_COLOR 
Judul.Font = Enum.Font.GothamBold
Judul.TextSize = 13
Judul.TextXAlignment = Enum.TextXAlignment.Left
Judul.ZIndex = 1
Judul.Parent = Frame

local TombolMinimize = Instance.new("TextButton")
TombolMinimize.Name = "MinimizeBtn"
TombolMinimize.Size = UDim2.new(0, 25, 0, 25)
TombolMinimize.Position = UDim2.new(1, -60, 0, 5) 
TombolMinimize.BackgroundColor3 = Color3.fromRGB(255, 180, 50) 
TombolMinimize.Text = "-"
TombolMinimize.TextColor3 = Color3.fromRGB(20, 20, 20)
TombolMinimize.Font = Enum.Font.GothamBold
TombolMinimize.ZIndex = 2 
TombolMinimize.Parent = Frame

Instance.new("UICorner", TombolMinimize).CornerRadius = UDim.new(0, 6)

local TombolTutup = Instance.new("TextButton")
TombolTutup.Name = "CloseBtn"
TombolTutup.Size = UDim2.new(0, 25, 0, 25)
TombolTutup.Position = UDim2.new(1, -30, 0, 5)
TombolTutup.BackgroundColor3 = Color3.fromRGB(255, 50, 50) 
TombolTutup.Text = "X"
TombolTutup.TextColor3 = Color3.fromRGB(255, 255, 255)
TombolTutup.Font = Enum.Font.GothamBold
TombolTutup.ZIndex = 2 
TombolTutup.Parent = Frame

Instance.new("UICorner", TombolTutup).CornerRadius = UDim.new(0, 6)

-- // 5. MEMBANGUN ELEMEN PENCARIAN & DAFTAR KATA // --
local InputBox = Instance.new("TextBox")
InputBox.Name = "SearchBox"
InputBox.Size = UDim2.new(1, -20, 0, 35)
InputBox.Position = UDim2.new(0, 10, 0, 40)
InputBox.BackgroundColor3 = INPUT_BG
InputBox.TextColor3 = NEON_COLOR 
InputBox.PlaceholderText = "Booting database..."
InputBox.PlaceholderColor3 = Color3.fromRGB(100, 130, 130)
InputBox.TextEditable = false 
InputBox.Font = Enum.Font.GothamBold
InputBox.TextSize = 14
InputBox.ClearTextOnFocus = false
InputBox.ZIndex = 1
InputBox.Parent = Frame

Instance.new("UICorner", InputBox).CornerRadius = UDim.new(0, 6)

local Garis = Instance.new("Frame")
Garis.Name = "SeparatorLine"
Garis.Size = UDim2.new(1, -20, 0, 1)
Garis.Position = UDim2.new(0, 10, 0, 85)
Garis.BackgroundColor3 = NEON_COLOR
Garis.BackgroundTransparency = 0.5
Garis.BorderSizePixel = 0
Garis.ZIndex = 1
Garis.Parent = Frame

local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Name = "ResultScroll"
ScrollFrame.Size = UDim2.new(1, -20, 1, -115) 
ScrollFrame.Position = UDim2.new(0, 10, 0, 90)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 3
ScrollFrame.ScrollBarImageColor3 = NEON_COLOR 
ScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y 
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ScrollFrame.ZIndex = 1
ScrollFrame.Parent = Frame

local TeksHasil = Instance.new("TextLabel")
TeksHasil.Name = "ResultText"
TeksHasil.Size = UDim2.new(1, -8, 0, 0) 
TeksHasil.Position = UDim2.new(0, 0, 0, 0)
TeksHasil.BackgroundTransparency = 1
TeksHasil.TextColor3 = Color3.fromRGB(200, 255, 255) 
TeksHasil.Text = "Menunggu input..."
TeksHasil.Font = Enum.Font.Gotham
TeksHasil.TextSize = 14
TeksHasil.TextYAlignment = Enum.TextYAlignment.Top
TeksHasil.AutomaticSize = Enum.AutomaticSize.Y 
TeksHasil.TextWrapped = true
TeksHasil.ZIndex = 1
TeksHasil.Parent = ScrollFrame

local Watermark = Instance.new("TextLabel")
Watermark.Name = "Watermark"
Watermark.Size = UDim2.new(1, 0, 0, 20)
Watermark.Position = UDim2.new(0, 0, 1, -20) 
Watermark.BackgroundTransparency = 1
Watermark.Text = "Path: Duckiezt/KBBI_Tools v2"
Watermark.TextColor3 = NEON_COLOR
Watermark.TextTransparency = 0.6
Watermark.Font = Enum.Font.Code 
Watermark.TextSize = 10
Watermark.ZIndex = 1
Watermark.Parent = Frame

-- // 6. LOGIC & FUNCTIONS // --

-- Fungsi Mencari Kata
local function cariKata()
	local inputTeks = string.lower(string.match(InputBox.Text, "%a+") or "")
	
	-- Jika input kosong, kembalikan ke status awal
	if inputTeks == "" then
		if #KamusIndonesia > 0 then
			TeksHasil.Text = "Menunggu input..."
			TeksHasil.TextColor3 = Color3.fromRGB(200, 255, 255)
		end
		return
	end
	
	local hasilDitemukan = {}
	local limit = 50 -- Batas maksimal kata yang ditampilkan agar tidak lag
	
	for _, kataDiKamus in ipairs(KamusIndonesia) do
		-- Mengecek apakah kata di kamus diawali dengan huruf yang diketik
		if string.sub(kataDiKamus, 1, string.len(inputTeks)) == inputTeks then
			table.insert(hasilDitemukan, string.upper(kataDiKamus))
			if #hasilDitemukan >= limit then break end
		end
	end
	
	-- Menampilkan Hasil
	if #hasilDitemukan > 0 then
		TeksHasil.Text = table.concat(hasilDitemukan, "\n")
		TeksHasil.TextColor3 = NEON_COLOR 
	else
		TeksHasil.Text = ">> NO DATA FOUND <<"
		TeksHasil.TextColor3 = Color3.fromRGB(255, 50, 50) 
	end
end

-- Load Data KBBI dari GitHub
task.spawn(function()
	local sukses, respons = pcall(function()
		return game:HttpGet(URL_KAMUS)
	end)

	if sukses and respons then
		-- Memasukkan kata ke dalam tabel
		for baris in string.gmatch(respons, "[^\r\n]+") do
			local kata = string.match(baris, "^(%a+)")
			if kata and string.len(kata) > 1 then
				table.insert(KamusIndonesia, string.lower(kata))
			end
		end
		
		-- Update UI setelah data berhasil dimuat
		Judul.Text = "KBBI Loaded. (" .. math.floor(#KamusIndonesia / 1000) .. "k Data)"
		InputBox.PlaceholderText = "TYPE PREFIX >>"
		InputBox.TextEditable = true
	else
		-- Handle error jika gagal mengambil data
		Judul.Text = "CONNECTION ERROR"
		Judul.TextColor3 = Color3.fromRGB(255, 50, 50)
		TeksHasil.Text = "Failed to retrieve KBBI data source."
		TeksHasil.TextColor3 = Color3.fromRGB(255, 100, 100)
	end
end)

-- // 7. EVENTS CONNECTIONS // --

-- Event Tombol Minimize
TombolMinimize.MouseButton1Click:Connect(function()
	isMinimized = not isMinimized
	if isMinimized then
		Frame.Size = UDim2.new(0, 180, 0, 35)
		TombolMinimize.Text = "+"
		NeonGlow.Enabled = false
	else
		Frame.Size = UDim2.new(0, 180, 0, 235) 
		TombolMinimize.Text = "-"
		NeonGlow.Enabled = true
	end
end)

-- Event Tombol Tutup
TombolTutup.MouseButton1Click:Connect(function() 
	ScreenGui:Destroy() 
end)

-- Event setiap kali teks di SearchBox berubah
InputBox:GetPropertyChangedSignal("Text"):Connect(cariKata)

-- // 8. AUTO DETECT & AUTO SEARCH SYSTEM (FIXED) // --

task.spawn(function()

    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

    local function connectToWordLabel(label)
        if label:IsA("TextLabel") then
            label:GetPropertyChangedSignal("Text"):Connect(function()

                local currentWord = string.lower(label.Text or "")
                local lastLetter = string.sub(currentWord, -3)

                if lastLetter then
                    
                    -- Kosongkan dulu
                    TeksHasil.Text = ""
                    
                    local hasilDitemukan = {}
                    local limit = 50

                    for _, kataDiKamus in ipairs(KamusIndonesia) do
                        if string.sub(kataDiKamus, 1, 1) == lastLetter then
                            table.insert(hasilDitemukan, string.upper(kataDiKamus))
                            if #hasilDitemukan >= limit then break end
                        end
                    end

                    if #hasilDitemukan > 0 then
                        TeksHasil.Text = table.concat(hasilDitemukan, "\n")
                        TeksHasil.TextColor3 = NEON_COLOR
                    else
                        TeksHasil.Text = ">> NO DATA FOUND <<"
                        TeksHasil.TextColor3 = Color3.fromRGB(255, 50, 50)
                    end
                end

            end)
        end
    end

    for _, obj in pairs(PlayerGui:GetDescendants()) do
        connectToWordLabel(obj)
    end

    PlayerGui.DescendantAdded:Connect(function(obj)
        connectToWordLabel(obj)
    end)

end)
